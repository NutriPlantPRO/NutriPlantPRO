<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Enmiendas - NutriPlant PRO</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px;
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .sections {
      display: grid;
      gap: 30px;
    }

    .section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border: 1px solid #e2e8f0;
    }

    .section h3 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #1e293b;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .item {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
      font-size: 0.9rem;
    }

    input {
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s ease;
      background: white;
    }

    input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    input:read-only {
      background: #f9fafb;
      cursor: not-allowed;
    }

    /* Estilos especiales para CIC Total */
    .cic-total-item {
      grid-column: 1 / -1;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 3px solid #e5e7eb;
    }

    .cic-total-input {
      background: #f0f9ff !important;
      border: 3px solid #0ea5e9 !important;
      font-weight: 700 !important;
      color: #0c4a6e !important;
      font-size: 1.2rem !important;
      text-align: center !important;
    }

    .cic-total-input:focus {
      border-color: #0284c7 !important;
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.2) !important;
    }

    .buttons {
      text-align: center;
      margin-top: 40px;
    }

    .btn {
      padding: 15px 30px;
      margin: 0 10px;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: #3b82f6;
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
      background: #6b7280;
      color: white;
    }

    .btn-secondary:hover {
      background: #4b5563;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    .results {
      margin-top: 30px;
      padding: 20px;
      background: #f0f9ff;
      border: 2px solid #0ea5e9;
      border-radius: 8px;
      display: none;
    }

    .results h4 {
      color: #0c4a6e;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 8px 0;
      border-bottom: 1px solid #bae6fd;
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-label {
      font-weight: 600;
      color: #374151;
    }

    .result-value {
      font-weight: 700;
      color: #0c4a6e;
    }

    .highlight {
      background: #fef3c7;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>游뚶 Calculadora de Enmiendas</h1>
      <p>C치lculo de enmiendas para ajuste de CIC del suelo - Versi칩n 2.0 con H y Al</p>
    </div>

    <div class="sections">
      <!-- An치lisis de Suelo Inicial -->
      <div class="section">
        <h3>游늵 An치lisis de Suelo Inicial</h3>
        <div class="grid">
          <div class="item">
            <label>Potasio (K) meq/100g:</label>
            <input type="number" id="k-initial" step="0.01" value="1.00">
          </div>
          <div class="item">
            <label>Calcio (Ca) meq/100g:</label>
            <input type="number" id="ca-initial" step="0.01" value="12.00">
          </div>
          <div class="item">
            <label>Magnesio (Mg) meq/100g:</label>
            <input type="number" id="mg-initial" step="0.01" value="3.00">
          </div>
          <div class="item">
            <label>Hidr칩geno (H) meq/100g:</label>
            <input type="number" id="h-initial" step="0.01" value="0.00">
          </div>
          <div class="item">
            <label>Sodio (Na) meq/100g:</label>
            <input type="number" id="na-initial" step="0.01" value="2.00">
          </div>
          <div class="item">
            <label>Aluminio (Al) meq/100g:</label>
            <input type="number" id="al-initial" step="0.01" value="0.00">
          </div>
          <div class="item cic-total-item">
            <label>CIC Total meq/100g:</label>
            <input type="number" id="cic-total" step="0.01" value="18.00" class="cic-total-input" readonly>
          </div>
        </div>
      </div>

      <!-- Objetivos de Ajuste -->
      <div class="section">
        <h3>游꿢 Objetivos de Ajuste</h3>
        <div class="grid">
          <div class="item">
            <label>% K objetivo:</label>
            <input type="number" id="k-target" step="0.01" value="6">
          </div>
          <div class="item">
            <label>% Ca objetivo:</label>
            <input type="number" id="ca-target" step="0.01" value="77">
          </div>
          <div class="item">
            <label>% Mg objetivo:</label>
            <input type="number" id="mg-target" step="0.01" value="17">
          </div>
          <div class="item">
            <label>% H objetivo:</label>
            <input type="number" id="h-target" step="0.01" value="0">
          </div>
          <div class="item">
            <label>% Na objetivo:</label>
            <input type="number" id="na-target" step="0.01" value="0">
          </div>
          <div class="item">
            <label>% Al objetivo:</label>
            <input type="number" id="al-target" step="0.01" value="0">
          </div>
        </div>
      </div>

      <!-- Propiedades del Suelo -->
      <div class="section">
        <h3>游꺔 Propiedades del Suelo</h3>
        <div class="grid">
          <div class="item">
            <label>Densidad aparente (g/cm췁):</label>
            <input type="number" id="soil-density" step="0.01" value="1.1">
          </div>
          <div class="item">
            <label>Profundidad (cm):</label>
            <input type="number" id="soil-depth" step="1" value="30">
          </div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn btn-primary" onclick="calculateAmendment()">游빑 Calcular Enmienda</button>
      <button class="btn btn-secondary" onclick="resetForm()">游댃 Reiniciar</button>
    </div>

    <div id="results" class="results">
      <h4>游늶 Resultados del C치lculo</h4>
      <div class="result-item">
        <span class="result-label">Enmienda recomendada:</span>
        <span id="amendment-type" class="result-value">-</span>
      </div>
      <div class="result-item">
        <span class="result-label">Cantidad (Kg/Ha):</span>
        <span id="amendment-amount" class="result-value">-</span>
      </div>
      <div class="result-item">
        <span class="result-label">Ca a aportar (Kg/Ha):</span>
        <span id="ca-contribution" class="result-value">-</span>
      </div>
      <div class="result-item">
        <span class="result-label">Na a remover (Kg/Ha):</span>
        <span id="na-removal" class="result-value">-</span>
      </div>
    </div>
  </div>

  <script>
    function calculateCIC() {
      const k = parseFloat(document.getElementById('k-initial').value || 0);
      const ca = parseFloat(document.getElementById('ca-initial').value || 0);
      const mg = parseFloat(document.getElementById('mg-initial').value || 0);
      const h = parseFloat(document.getElementById('h-initial').value || 0);
      const na = parseFloat(document.getElementById('na-initial').value || 0);
      const al = parseFloat(document.getElementById('al-initial').value || 0);
      
      const cic = k + ca + mg + h + na + al;
      document.getElementById('cic-total').value = cic.toFixed(2);
    }

    function calculateAmendment() {
      // Obtener valores del an치lisis inicial
      const kInitial = parseFloat(document.getElementById('k-initial').value || 0);
      const caInitial = parseFloat(document.getElementById('ca-initial').value || 0);
      const mgInitial = parseFloat(document.getElementById('mg-initial').value || 0);
      const hInitial = parseFloat(document.getElementById('h-initial').value || 0);
      const naInitial = parseFloat(document.getElementById('na-initial').value || 0);
      const alInitial = parseFloat(document.getElementById('al-initial').value || 0);
      const cicTotal = parseFloat(document.getElementById('cic-total').value || 0);
      
      // Obtener objetivos
      const kTarget = parseFloat(document.getElementById('k-target').value || 0);
      const caTarget = parseFloat(document.getElementById('ca-target').value || 0);
      const mgTarget = parseFloat(document.getElementById('mg-target').value || 0);
      const hTarget = parseFloat(document.getElementById('h-target').value || 0);
      const naTarget = parseFloat(document.getElementById('na-target').value || 0);
      const alTarget = parseFloat(document.getElementById('al-target').value || 0);
      
      // Obtener propiedades del suelo
      const soilDensity = parseFloat(document.getElementById('soil-density').value || 1.4);
      const soilDepth = parseFloat(document.getElementById('soil-depth').value || 30);
      
      // Validar que los objetivos sumen 100%
      const totalTarget = kTarget + caTarget + mgTarget + hTarget + naTarget + alTarget;
      if (Math.abs(totalTarget - 100) > 0.1) {
        alert('Los porcentajes objetivo deben sumar 100%');
        return;
      }
      
      // Calcular meq/100g objetivo
      const kTargetMeq = (kTarget / 100) * cicTotal;
      const caTargetMeq = (caTarget / 100) * cicTotal;
      const mgTargetMeq = (mgTarget / 100) * cicTotal;
      const hTargetMeq = (hTarget / 100) * cicTotal;
      const naTargetMeq = (naTarget / 100) * cicTotal;
      const alTargetMeq = (alTarget / 100) * cicTotal;
      
      // Calcular diferencias
      const kDiff = kTargetMeq - kInitial;
      const caDiff = caTargetMeq - caInitial;
      const mgDiff = mgTargetMeq - mgInitial;
      const hDiff = hTargetMeq - hInitial;
      const naDiff = naTargetMeq - naInitial;
      const alDiff = alTargetMeq - alInitial;
      
      // Convertir a meq/kg
      const kMeqKg = kDiff * 10;
      const caMeqKg = caDiff * 10;
      const mgMeqKg = mgDiff * 10;
      const hMeqKg = hDiff * 10;
      const naMeqKg = naDiff * 10;
      const alMeqKg = alDiff * 10;
      
      // Convertir a ppm (mg/kg)
      const kPpm = kMeqKg * 39.1; // Peso at칩mico del K
      const caPpm = caMeqKg * 20.04; // Peso at칩mico del Ca
      const mgPpm = mgMeqKg * 12.15; // Peso at칩mico del Mg
      const hPpm = hMeqKg * 1.008; // Peso at칩mico del H
      const naPpm = naMeqKg * 23; // Peso at칩mico del Na
      const alPpm = alMeqKg * 8.99; // Peso at칩mico del Al
      
      // Calcular volumen de suelo por hect치rea (m췁)
      const soilVolume = soilDepth / 100; // m췁 por m
      const soilVolumeHa = soilVolume * 10000; // m췁 por hect치rea
      
      // Calcular peso del suelo por hect치rea (kg)
      const soilWeightHa = soilVolumeHa * soilDensity * 1000; // kg/ha
      
      // Calcular kg/ha de cada elemento
      const kKgHa = (kPpm * soilWeightHa) / 1000000;
      const caKgHa = (caPpm * soilWeightHa) / 1000000;
      const mgKgHa = (mgPpm * soilWeightHa) / 1000000;
      const hKgHa = (hPpm * soilWeightHa) / 1000000;
      const naKgHa = (naPpm * soilWeightHa) / 1000000;
      const alKgHa = (alPpm * soilWeightHa) / 1000000;
      
      // Determinar enmienda recomendada
      let amendmentType = 'Yeso Agr칤cola';
      let amendmentAmount = 0;
      
      if (caDiff > 0 && naDiff < 0) {
        // Necesitamos Ca y reducir Na - Yeso Agr칤cola
        amendmentType = 'Yeso Agr칤cola';
        amendmentAmount = Math.abs(caKgHa) / 0.2353; // 23.53% Ca en yeso
      } else if (caDiff > 0 && naDiff >= 0) {
        // Solo necesitamos Ca - Cal Agr칤cola
        amendmentType = 'Cal Agr칤cola';
        amendmentAmount = Math.abs(caKgHa) / 0.40; // 40% Ca en cal
      } else if (caDiff > 0 && mgDiff > 0) {
        // Necesitamos Ca y Mg - Cal Dolomita
        amendmentType = 'Cal Dolomita';
        amendmentAmount = Math.max(Math.abs(caKgHa) / 0.217, Math.abs(mgKgHa) / 0.132);
      }
      
      // Mostrar resultados
      showResults(amendmentType, amendmentAmount, caKgHa, naKgHa);
    }

    function showResults(type, amount, caContribution, naRemoval) {
      const resultsSection = document.getElementById('results');
      const typeElement = document.getElementById('amendment-type');
      const amountElement = document.getElementById('amendment-amount');
      const caElement = document.getElementById('ca-contribution');
      const naElement = document.getElementById('na-removal');
      
      resultsSection.style.display = 'block';
      
      typeElement.textContent = type;
      amountElement.textContent = `${amount.toFixed(0)} Kg/Ha`;
      caElement.textContent = `${caContribution.toFixed(1)} Kg/Ha`;
      naElement.textContent = `${Math.abs(naRemoval).toFixed(1)} Kg/Ha`;
    }

    function resetForm() {
      // Resetear valores iniciales
      document.getElementById('k-initial').value = '1.00';
      document.getElementById('ca-initial').value = '12.00';
      document.getElementById('mg-initial').value = '3.00';
      document.getElementById('h-initial').value = '0.00';
      document.getElementById('na-initial').value = '2.00';
      document.getElementById('al-initial').value = '0.00';
      document.getElementById('cic-total').value = '18.00';
      
      // Resetear objetivos
      document.getElementById('k-target').value = '6';
      document.getElementById('ca-target').value = '77';
      document.getElementById('mg-target').value = '17';
      document.getElementById('h-target').value = '0';
      document.getElementById('na-target').value = '0';
      document.getElementById('al-target').value = '0';
      
      // Resetear propiedades del suelo
      document.getElementById('soil-density').value = '1.4';
      document.getElementById('soil-depth').value = '30';
      
      // Ocultar resultados
      document.getElementById('results').style.display = 'none';
    }

    // Auto-calcular CIC cuando cambien los valores
    const inputs = ['k-initial', 'ca-initial', 'mg-initial', 'h-initial', 'na-initial', 'al-initial'];
    inputs.forEach(id => {
      document.getElementById(id).addEventListener('input', calculateCIC);
    });

    // Calcular CIC inicial
    calculateCIC();
  </script>
</body>
</html>





