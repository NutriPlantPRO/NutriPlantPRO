<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora VPD - Gratis</title>
  <link rel="stylesheet" href="dashboard.css" />
  <style>
    body {
      margin: 0;
      padding: 16px;
      background: #f8fafc;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .wrap {
      position: relative;
      background: #fff;
      border-radius: 12px;
      padding: 16px;
    }
    .note {
      margin: 0 0 14px;
      color: #64748b;
      font-size: 12px;
      text-align: center;
    }
    .wm {
      position: absolute;
      top: 12px;
      right: 12px;
      pointer-events: none;
    }
    .wm img {
      max-height: 56px;
      opacity: 0.25;
    }
    .title {
      margin: 0 0 18px;
      font-size: 24px;
      color: #0f172a;
      font-weight: 800;
    }
    /* M√≥vil: alinear inputs Temp y Humedad (misma altura) */
    @media (max-width: 600px) {
      .vpd-grid-cell {
        display: flex;
        flex-direction: column;
        align-items: stretch;
      }
      .vpd-grid-cell label {
        min-height: 2.8em;
        display: flex;
        align-items: flex-end;
        margin-bottom: 8px;
      }
      .vpd-grid-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        align-items: end;
      }
    }
  </style>
</head>
<body>
  <p class="note">Modo gratuito: no guarda datos. Al cerrar, se reinicia.</p>
  <div class="wrap">
    <div class="wm" aria-hidden="true"><img src="assets/NutriPlant_PRO_blue.png" alt=""></div>
    <h2 class="title">üå°Ô∏è D√©ficit de Presi√≥n de Vapor</h2>

    <div style="background:#f0f9ff;border:2px solid #0ea5e9;border-radius:12px;padding:24px;margin-bottom:24px;">
      <h3 style="margin:0 0 20px;color:#0369a1;font-size:18px;font-weight:600;">üìä Calculadora Ambiental Simple</h3>

      <div class="vpd-grid-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
        <div class="vpd-grid-cell" style="background:white;padding:16px;border-radius:8px;border:1px solid #e5e7eb;">
          <label style="display:block;margin-bottom:8px;font-weight:500;color:#374151;">üå°Ô∏è Temperatura del Aire (¬∞C)</label>
          <input id="vpd-env-temp" type="number" step="0.1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 20.5" />
        </div>
        <div class="vpd-grid-cell" style="background:white;padding:16px;border-radius:8px;border:1px solid #e5e7eb;">
          <label style="display:block;margin-bottom:8px;font-weight:500;color:#374151;">üíß Humedad Relativa (%)</label>
          <input id="vpd-env-humidity" type="number" step="0.1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 85" />
        </div>
      </div>

      <button onclick="calculateEnvironmentalVPDFree()" style="width:100%;padding:14px;background:#22c55e;color:white;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;">üìä Calcular VPD</button>
      <div id="vpd-environmental-results" style="margin-top:16px;"></div>
    </div>

    <div style="background:#f0fdf4;border:2px solid #22c55e;border-radius:12px;padding:24px;">
      <h3 style="margin:0 0 20px;color:#15803d;font-size:18px;font-weight:600;">üî¨ Calculadora Avanzada</h3>

      <div class="vpd-grid-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
        <div class="vpd-grid-cell" style="background:white;padding:16px;border-radius:8px;border:1px solid #e5e7eb;">
          <label style="display:block;margin-bottom:8px;font-weight:500;color:#374151;">üå°Ô∏è Temperatura del Aire (¬∞C)</label>
          <input id="vpd-adv-air-temp" type="number" step="0.1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 25" />
        </div>
        <div class="vpd-grid-cell" style="background:white;padding:16px;border-radius:8px;border:1px solid #e5e7eb;">
          <label style="display:block;margin-bottom:8px;font-weight:500;color:#374151;">üíß Humedad Relativa (%)</label>
          <input id="vpd-adv-humidity" type="number" step="0.1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 80" />
        </div>
      </div>

      <div style="background:white;padding:16px;border-radius:8px;border:1px solid #e5e7eb;margin-bottom:20px;">
        <label style="display:block;margin-bottom:12px;font-weight:600;color:#1e293b;">Modo de C√°lculo:</label>
        <div style="margin-bottom:16px;">
          <label style="display:flex;align-items:center;cursor:pointer;padding:12px;border-radius:8px;background:#f9fafb;margin-bottom:8px;">
            <input type="radio" name="vpd-mode-free" value="leaf" checked style="margin-right:10px;width:18px;height:18px;cursor:pointer;" onchange="toggleVPDModeFree()" />
            <span style="font-weight:500;">üåø Temperatura de Hoja</span>
          </label>
          <div id="vpd-leaf-input" style="margin-left:28px;margin-top:8px;">
            <input id="vpd-leaf-temp" type="number" step="0.1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 27.4" />
          </div>
        </div>
        <div>
          <label style="display:flex;align-items:center;cursor:pointer;padding:12px;border-radius:8px;background:#f9fafb;">
            <input type="radio" name="vpd-mode-free" value="radiation" style="margin-right:10px;width:18px;height:18px;cursor:pointer;" onchange="toggleVPDModeFree()" />
            <span style="font-weight:500;">‚òÄÔ∏è Radiaci√≥n Solar</span>
          </label>
          <div id="vpd-radiation-input" style="margin-left:28px;margin-top:8px;display:none;">
            <input id="vpd-solar-radiation" type="number" step="1" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:16px;" placeholder="Ej: 600 W/m¬≤" />
            <p style="margin:8px 0 0;font-size:13px;color:#64748b;">La temperatura de hoja se calcular√° autom√°ticamente</p>
          </div>
        </div>
      </div>

      <button onclick="calculateAdvancedVPDFree()" style="width:100%;padding:14px;background:#22c55e;color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;">üìä Calcular D√©ficit de Presi√≥n de Vapor</button>
      <div id="vpd-advanced-results" style="margin-top:16px;"></div>
    </div>
  </div>

  <script>
    function calculateVPDSimple(airTemp, humidity) {
      const es = 0.6108 * Math.exp((17.27 * airTemp) / (airTemp + 237.3));
      const ea = es * (humidity / 100);
      const vpd = es - ea;
      const hd = (vpd * 216.7) / (airTemp + 273.15);
      return { vpd: parseFloat(vpd.toFixed(2)), hd: parseFloat(hd.toFixed(2)) };
    }

    function calculateLeafTempFromRadiation(airTemp, solarRadiation) {
      const factor = 250;
      const leafTemp = airTemp + (solarRadiation / factor) * 2.5;
      return parseFloat(leafTemp.toFixed(1));
    }

    function calculateVPDAdvanced(airTemp, airHumidity, leafTemp) {
      const esLeaf = 0.6108 * Math.exp((17.27 * leafTemp) / (leafTemp + 237.3));
      const esAir = 0.6108 * Math.exp((17.27 * airTemp) / (airTemp + 237.3));
      const ea = esAir * (airHumidity / 100);
      const vpd = esLeaf - ea;
      const hd = (vpd * 216.7) / (airTemp + 273.15);
      return { vpd: parseFloat(vpd.toFixed(2)), hd: parseFloat(hd.toFixed(2)) };
    }

    function createVPDRangeChart(vpdValue) {
      const minVPD = 0;
      const maxVPD = 3.0;
      const optimalMin = 0.5;
      const optimalMax = 1.5;
      const range = maxVPD - minVPD;
      let barColor = '#10b981';
      let status = '√ìptimo';
      if (vpdValue < optimalMin) { barColor = '#3b82f6'; status = 'Bajo'; }
      else if (vpdValue > optimalMax) { barColor = '#ef4444'; status = 'Alto'; }
      const position = Math.max(0, Math.min(100, ((vpdValue - minVPD) / range) * 100));
      const blueEndPos = (0.5 / range) * 100;
      const greenEndPos = (1.5 / range) * 100;
      const tickLabelsHTML = [];
      for (let i = 0.5; i <= 3.0; i += 0.5) {
        const tickPos = (i / range) * 100;
        tickLabelsHTML.push(`<div style="position:absolute;left:${tickPos}%;top:0;transform:translateX(-50%);font-size:10px;color:#64748b;white-space:nowrap;">${i.toFixed(1)}</div>`);
      }
      return `
        <div style="margin:20px 0;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:50px;">
            <span style="font-weight:600;color:#1e293b;">Rango √ìptimo: ${optimalMin} - ${optimalMax} kPa</span>
            <span style="font-weight:600;color:${barColor};">Estado: ${status}</span>
          </div>
          <div style="position:relative;height:50px;background:linear-gradient(to right,#3b82f6 0%,#3b82f6 ${blueEndPos * 0.85}%,#60a5fa ${blueEndPos * 0.92}%,#34d399 ${blueEndPos * 0.98}%,#22d3ee ${blueEndPos}%,#10b981 ${blueEndPos + (greenEndPos - blueEndPos) * 0.3}%,#10b981 ${greenEndPos * 0.85}%,#10b981 ${greenEndPos}%,#fbbf24 ${greenEndPos + (100 - greenEndPos) * 0.15}%,#fbbf24 ${greenEndPos + (100 - greenEndPos) * 0.35}%,#f59e0b ${greenEndPos + (100 - greenEndPos) * 0.5}%,#fb923c ${greenEndPos + (100 - greenEndPos) * 0.65}%,#f97316 ${greenEndPos + (100 - greenEndPos) * 0.78}%,#f87171 ${greenEndPos + (100 - greenEndPos) * 0.88}%,#ef4444 95%,#dc2626 100%);border-radius:8px;overflow:visible;border:2px solid #e5e7eb;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);">
            <div style="position:absolute;left:${blueEndPos}%;width:2px;height:100%;background:rgba(255,255,255,0.9);box-shadow:0 0 3px rgba(0,0,0,0.4);z-index:2;"></div>
            <div style="position:absolute;left:${greenEndPos}%;width:2px;height:100%;background:rgba(255,255,255,0.9);box-shadow:0 0 3px rgba(0,0,0,0.4);z-index:2;"></div>
            <div style="position:absolute;left:${position}%;top:-8px;width:3px;height:66px;background:white;border-radius:2px;box-shadow:0 3px 6px rgba(0,0,0,0.4);transform:translateX(-50%);z-index:10;"></div>
            <div style="position:absolute;left:${position}%;top:-12px;width:24px;height:24px;background:white;border:3px solid #1e293b;border-radius:50%;box-shadow:0 3px 8px rgba(0,0,0,0.5);transform:translateX(-50%);z-index:11;display:flex;align-items:center;justify-content:center;"><div style="width:8px;height:8px;background:#1e293b;border-radius:50%;"></div></div>
            <div style="position:absolute;left:${position}%;top:-52px;transform:translateX(-50%);z-index:12;background:#1e293b;color:white;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:700;white-space:nowrap;box-shadow:0 2px 4px rgba(0,0,0,0.3);">${vpdValue.toFixed(2)} kPa</div>
          </div>
          <div style="position:relative;height:20px;margin-top:2px;">${tickLabelsHTML.join('')}</div>
          <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:12px;color:#64748b;"><span style="font-weight:500;">0 kPa</span><span style="font-weight:500;">3.0 kPa</span></div>
        </div>
      `;
    }

    function calculateEnvironmentalVPDFree() {
      const t = parseFloat(document.getElementById('vpd-env-temp').value);
      const h = parseFloat(document.getElementById('vpd-env-humidity').value);
      if (isNaN(t) || isNaN(h)) {
        alert('‚ö†Ô∏è Por favor ingresa temperatura del aire y humedad relativa');
        return;
      }
      if (h < 0 || h > 100) {
        alert('‚ö†Ô∏è La humedad relativa debe estar entre 0 y 100%');
        return;
      }
      const r = calculateVPDSimple(t, h);
      document.getElementById('vpd-environmental-results').innerHTML = `
        <div style="background:white;padding:20px;border-radius:8px;border:1px solid #e5e7eb;">
          <h4 style="margin:0 0 16px;color:#1e293b;font-size:16px;font-weight:600;">Resultados:</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
            <div><div style="color:#64748b;font-size:14px;margin-bottom:4px;">D√©ficit de Presi√≥n de Vapor</div><div style="font-size:24px;font-weight:700;color:#0ea5e9;">${r.vpd} kPa</div></div>
            <div><div style="color:#64748b;font-size:14px;margin-bottom:4px;">D√©ficit de Humedad</div><div style="font-size:24px;font-weight:700;color:#0ea5e9;">${r.hd} g/m¬≥</div></div>
          </div>
          ${createVPDRangeChart(r.vpd)}
        </div>
      `;
    }

    function toggleVPDModeFree() {
      const mode = document.querySelector('input[name="vpd-mode-free"]:checked')?.value;
      const leaf = document.getElementById('vpd-leaf-input');
      const rad = document.getElementById('vpd-radiation-input');
      if (mode === 'leaf') { leaf.style.display = 'block'; rad.style.display = 'none'; }
      else { leaf.style.display = 'none'; rad.style.display = 'block'; }
    }

    function calculateAdvancedVPDFree() {
      const airTemp = parseFloat(document.getElementById('vpd-adv-air-temp').value);
      const airHumidity = parseFloat(document.getElementById('vpd-adv-humidity').value);
      const mode = document.querySelector('input[name="vpd-mode-free"]:checked')?.value;
      if (isNaN(airTemp) || isNaN(airHumidity)) {
        alert('‚ö†Ô∏è Por favor ingresa temperatura del aire y humedad relativa');
        return;
      }
      if (airHumidity < 0 || airHumidity > 100) {
        alert('‚ö†Ô∏è La humedad relativa debe estar entre 0 y 100%');
        return;
      }
      let leafTemp = null;
      let calculatedLeafTemp = null;
      if (mode === 'leaf') {
        leafTemp = parseFloat(document.getElementById('vpd-leaf-temp').value);
        if (isNaN(leafTemp)) { alert('‚ö†Ô∏è Por favor ingresa la temperatura de hoja'); return; }
      } else {
        const solarRadiation = parseFloat(document.getElementById('vpd-solar-radiation').value);
        if (isNaN(solarRadiation)) { alert('‚ö†Ô∏è Por favor ingresa la radiaci√≥n solar'); return; }
        calculatedLeafTemp = calculateLeafTempFromRadiation(airTemp, solarRadiation);
        leafTemp = calculatedLeafTemp;
      }
      const r = calculateVPDAdvanced(airTemp, airHumidity, leafTemp);
      document.getElementById('vpd-advanced-results').innerHTML = `
        <div style="background:white;padding:20px;border-radius:8px;border:1px solid #e5e7eb;">
          <h4 style="margin:0 0 16px;color:#1e293b;font-size:16px;font-weight:600;">Resultados:</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
            <div><div style="color:#64748b;font-size:14px;margin-bottom:4px;">D√©ficit de Presi√≥n de Vapor</div><div style="font-size:24px;font-weight:700;color:#22c55e;">${r.vpd} kPa</div></div>
            <div><div style="color:#64748b;font-size:14px;margin-bottom:4px;">D√©ficit de Humedad</div><div style="font-size:24px;font-weight:700;color:#22c55e;">${r.hd} g/m¬≥</div></div>
          </div>
          ${calculatedLeafTemp ? `<div style="margin-bottom:16px;padding:12px;background:#f0fdf4;border-radius:6px;border:1px solid #86efac;"><div style="color:#15803d;font-size:14px;margin-bottom:4px;">üåø Temperatura de Hoja Calculada:</div><div style="font-size:20px;font-weight:700;color:#15803d;">${calculatedLeafTemp} ¬∞C</div></div>` : ''}
          ${createVPDRangeChart(r.vpd)}
        </div>
      `;
    }
  </script>
</body>
</html>
